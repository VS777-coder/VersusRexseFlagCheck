<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Versus Revise - Triple Stop Integrator (Color Fixed)</title>
    <style>
        * { box-sizing: border-box; }
        body { background-color: #121212; color: #fff; font-family: sans-serif; margin: 0; padding: 5px; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* 統合ナビゲーション：リール選択ボタンの彩色とテキストカラー */
        .stop-tabs { display: flex; width: 100%; background: #000; border: 1px solid #444; border-radius: 8px; margin-bottom: 5px; flex-shrink: 0; overflow: hidden; }
        .stop-tab { 
            flex: 1; text-align: center; padding: 12px 0; font-size: 13px; font-weight: 900; 
            cursor: pointer; border-right: 1px solid #222; transition: 0.3s;
            opacity: 0.35; /* 非選択時はかなり薄く */
            filter: grayscale(0.5);
        }
        .stop-tab:last-child { border-right: none; }

        /* 左：サクラ（背景）× 濃いワイン（文字） */
        #stop-left { background: #ffb7ce; color: #a01040; }   
        /* 中：スカイ（背景）× 濃い紺（文字） */
        #stop-middle { background: #b3e5fc; color: #01579b; } 
        /* 右：ミント（背景）× 濃い緑（文字） */
        #stop-right { background: #c8e6c9; color: #1b5e20; }  

        /* 選択中のボタン：不透明度を最大にし、文字色を際立たせる */
        .stop-tab.active { 
            opacity: 1; 
            filter: grayscale(0);
            box-shadow: inset 0 0 12px rgba(255,255,255,0.5);
            text-shadow: 0 0 1px rgba(0,0,0,0.2);
            z-index: 1;
        }

        /* 状態タブの配色 */
        .state-tabs { display: flex; width: 100%; height: 55px; flex-shrink: 0; background: #222; border: 1px solid #444; border-radius: 4px; overflow: hidden; margin-bottom: 5px; }
        .state-tab { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; opacity: 0.6; transition: 0.2s; text-align: center; line-height: 1.2; }
        .state-tab.active { opacity: 1; border-bottom: 4px solid #fff; }
        #tab-hazure { background: #ffffff; color: #000; }
        #tab-x_flag { background: #304ffe; color: #fff; }
        #tab-seven_flag { background: #d50000; color: #fff; }
        #tab-bar_flag { background: #111; color: #fff; border-bottom: 3px solid #777; }

        .main-content { display: flex; flex-direction: row-reverse; flex: 1; overflow: hidden; gap: 4px; width: 100%; }
        .reel-frame { width: 100px; height: 490px; background: #000; border: 2px solid #444; border-radius: 8px; overflow: hidden; flex-shrink: 0; position: relative; touch-action: none; }
        #reel-window { position: absolute; width: 100%; top: 0; left: 0; pointer-events: none; }
        .symbol { height: 70px; display: flex; border-bottom: 1px solid #1a1a1a; width: 100%; box-sizing: border-box; }
        .index-num { width: 20px; color: #ffd700; text-align: center; font-size: 9px; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .symbol-image { flex: 1; height: 100%; background-size: 100% 2100%; background-repeat: repeat-y; }
        .guide-box { position: absolute; top: 140px; left: 0; width: 100%; height: 210px; border: 3px solid #ff0000; background: rgba(255, 0, 0, 0.05); pointer-events: none; z-index: 10; box-shadow: inset 0 0 10px rgba(255, 0, 0, 0.3); }

        .result-area { flex: 1; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; overflow-y: auto; display: flex; flex-direction: column; }
        .flag-item { display: flex; align-items: center; min-height: 42px; padding: 0 6px; border-bottom: 1px solid #222; border-left: 5px solid rgba(0,0,0,0.5); }
        .flag-name { font-size: 13px; font-weight: bold; width: 75px; flex-shrink: 0; }
        .flag-data { font-size: 15px; color: #fff; font-family: monospace; text-align: right; flex: 1; }

        /* フラグ配色リスト */
        .c-rep { border-left-color: #00ccff; color: #00ccff; background: rgba(0, 204, 255, 0.08); } 
        .c-bell { border-left-color: #eeee00; color: #eeee00; background: rgba(238, 238, 0, 0.08); } 
        .c-suika { border-left-color: #00ff66; color: #00ff66; background: rgba(0, 255, 102, 0.08); } 
        .c-cher { border-left-color: #ff0066; color: #ff0066; background: rgba(255, 0, 102, 0.08); }
        .c-hazure { border-left-color: #888888; color: #cccccc; background: rgba(136, 136, 136, 0.08); }
        .c-tok { border-left-color: #cc33ff; color: #cc33ff; background: rgba(204, 51, 255, 0.08); }
    </style>
</head>
<body>

    <div class="stop-tabs">
        <div id="stop-left" class="stop-tab active" onclick="switchStop('left')">左リール</div>
        <div id="stop-middle" class="stop-tab" onclick="switchStop('middle')">中リール</div>
        <div id="stop-right" class="stop-tab" onclick="switchStop('right')">右リール</div>
    </div>

    <div class="state-tabs">
        <div id="tab-hazure" class="state-tab active" onclick="switchState('hazure')">ボーナス未成立</div>
        <div id="tab-x_flag" class="state-tab" onclick="switchState('x_flag')">Ｘビッグ成立</div>
        <div id="tab-seven_flag" class="state-tab" onclick="switchState('seven_flag')">７ビッグ成立</div>
        <div id="tab-bar_flag" class="state-tab" onclick="switchState('bar_flag')">Reg成立</div>
    </div>

    <div class="main-content">
        <div id="reel-touch-area" class="reel-frame">
            <div class="guide-box"></div><div id="reel-window"></div>
        </div>
        <div class="result-area"><div id="flag-list"></div></div>
    </div>

<script>
const n = null;
const FLAGS = [
    {k:"hz",n:"ハズレ",c:"hazure"},{k:"nr",n:"通常リプ",c:"rep"},{k:"jr",n:"JACリプ",c:"rep"},{k:"rr",n:"RTリプ",c:"rep"},
    {k:"ba",n:"ベルA",c:"bell"},{k:"bb",n:"ベルB",c:"bell"},{k:"sa",n:"スイカA",c:"suika"},{k:"sb",n:"スイカB",c:"suika"},
    {k:"ca",n:"チェリーA",c:"cher"},{k:"cb",n:"チェリーB",c:"cher"},{k:"ta",n:"特殊役A",c:"tok"},{k:"tb",n:"特殊役B",c:"tok"},
    {k:"tc",n:"特殊役C",c:"tok"},{k:"td",n:"特殊役D",c:"tok"},{k:"te",n:"特殊役E",c:"tok"}
];

const MASTER_STORE = {
    // 左リール
    left: { img: "reel1.png", data: { hazure:{hz:[2,2,4,4,0,1,1,1,0,1,0,1,2,3,0,1,0,1,2,0,0],nr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],jr:[1,2,0,1,2,3,0,0,2,2,4,2,3,4,2,3,0,1,1,3,3],rr:[0,1,2,3,4,0,0,1,1,2,0,1,2,3,4,0,0,1,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],sa:[2,1,4,3,0,0,1,1,4,0,2,2,4,4,0,1,1,2,2,3,1],sb:[2,1,4,3,0,0,1,1,4,0,2,2,4,4,0,1,1,2,2,3,1],ca:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,1,2,3],cb:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,1,2,3],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},x_flag:{hz:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0],nr:[0,1,2,3,4,0,1,2,3,4,0,4,2,3,4,0,1,0,3,2,3],jr:[0,2,2,4,0,0,1,1,0,0,2,1,4,3,0,1,1,2,4,0,1],rr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[1,1,2,4,0,1,1,2,4,0,2,4,2,4,0,1,2,3,4,2,1],sa:[2,3,4,4,0,1,2,3,4,0,2,2,4,4,0,1,0,1,2,3,1],sb:[2,3,4,4,0,1,2,3,4,0,2,2,4,4,0,1,0,1,2,3,1],ca:[4,0,1,0,1,2,3,4,4,1,2,0,1,0,1,2,3,4,1,2,3],cb:[4,0,1,0,1,2,3,4,4,1,2,0,1,0,1,2,3,4,1,2,3],ta:[2,2,4,4,0,1,2,3,4,1,2,2,4,4,0,1,0,0,0,0,0],tb:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0],tc:[2,2,4,4,0,1,2,3,4,1,2,2,4,4,0,1,0,0,0,0,0],td:[1,4,3,4,0,1,2,3,4,2,2,2,2,4,0,0,0,1,1,3,3],te:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0]},seven_flag:{hz:[1,1,3,3,0,1,0,0,0,1,1,1,3,3,4,1,2,3,4,1,1],nr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],jr:[1,1,4,1,4,1,4,2,1,0,1,2,0,4,4,0,4,1,1,3,0],rr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,0,0,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[2,2,4,4,0,1,1,1,0,1,0,1,2,3,0,1,0,1,2,0,0],suikaA:[2,1,4,3,0,0,1,1,1,1,2,2,4,4,0,1,1,2,2,3,1],suikaB:[2,1,4,3,0,0,1,1,1,1,2,2,4,4,0,1,1,2,2,3,1],ca:[4,0,1,0,1,2,3,4,1,1,2,0,1,0,1,2,3,4,1,2,3],cb:[4,0,1,0,1,2,3,4,1,1,2,0,1,0,1,2,3,4,1,2,3],ta:[2,1,4,3,0,0,1,1,0,1,2,2,4,4,0,1,1,2,2,3,1],tb:[1,3,3,4,0,1,0,1,0,1,1,1,3,3,4,1,0,1,2,1,1],tc:[0,1,3,3,0,1,2,1,0,0,1,2,3,4,0,1,2,1,2,3,0],td:[2,3,3,4,4,1,2,1,0,0,1,2,3,4,4,1,0,1,2,3,0],te:[2,3,3,4,4,1,2,1,0,0,1,2,3,4,4,1,0,1,2,3,0]},bar_flag:{hz:[1,1,3,3,0,1,0,0,0,1,1,1,3,3,0,1,2,3,4,1,1],nr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],jr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],rr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[1,1,2,4,0,1,1,2,4,0,0,4,2,3,0,1,2,3,4,2,1],suikaA:[2,1,4,3,0,0,1,1,0,0,2,2,4,4,0,1,2,3,4,3,1],suikaB:[2,1,4,3,0,0,1,1,0,0,2,2,4,4,0,1,2,3,4,3,1],ca:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,4,2,3],cb:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,4,2,3],ta:[0,1,3,3,0,1,2,1,0,0,1,2,3,4,0,1,2,3,4,3,1],tb:[2,3,3,4,0,1,2,1,0,0,1,2,3,4,0,1,0,1,2,3,1],tc:[0,1,3,3,0,1,2,1,0,0,1,2,3,4,0,1,2,3,4,3,0],td:[2,2,4,4,0,1,2,3,0,1,0,2,3,3,0,1,0,0,0,3,0],te:[2,3,3,4,0,1,2,1,0,0,1,2,3,4,0,1,0,1,2,3,1]}} },
    // 中リール
    middle: { img: "reel2.png", data: { hazure:{hz:[2,0,1,2,0,1,0,3,2,3,1,1,3,3,1,1,3,3,1,0,3],nr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],jr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],rr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],ba:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],bb:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],sa:[3,4,4,2,0,0,0,1,2,3,4,1,2,3,4,2,1,0,1,0,1],sb:[3,4,4,2,0,0,0,1,2,3,4,1,2,3,4,2,1,0,1,0,1],ca:[2,0,1,2,0,1,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],cb:[2,0,1,2,0,1,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},x_flag:{hz:[0,3,2,1,1,2,1,4,0,4,2,1,0,0,0,1,2,3,4,4,1],nr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],jr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],rr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],ba:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],bb:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],sa:[2,3,4,2,0,0,0,2,2,4,4,1,2,0,0,2,3,0,1,2,1],sb:[2,3,4,2,0,0,0,2,2,4,4,1,2,0,0,2,3,0,1,2,1],ca:[2,0,1,2,0,1,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],cb:[2,0,1,2,0,1,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],ta:[2,4,4,2,0,1,0,3,4,4,4,2,2,0,0,0,3,4,4,4,1],tb:[2,0,0,2,0,0,0,1,2,2,3,4,2,0,0,0,3,4,4,4,1],tc:[2,4,4,2,0,1,0,3,4,2,3,4,2,0,0,0,3,4,4,4,1],td:[1,0,1,1,0,0,0,1,1,3,3,4,2,0,0,2,1,2,3,4,3],te:[2,0,0,2,0,1,0,3,4,0,1,2,2,0,0,0,3,4,4,4,1]},seven_flag:{hz:[3,0,1,2,3,0,0,2,2,3,4,4,2,3,4,2,3,4,0,1,2],nr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],jr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],rr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],ba:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],bb:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],sa:[2,3,4,2,0,0,0,1,2,3,4,4,2,0,0,2,3,0,1,2,1],sb:[2,3,4,2,0,0,0,1,2,3,4,4,2,0,0,2,3,0,1,2,1],ca:[2,0,1,2,0,0,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],cb:[2,0,1,2,0,0,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],ta:[2,4,4,2,0,0,0,1,2,4,4,4,2,0,0,0,3,4,0,4,1],tb:[4,2,1,1,2,0,0,0,2,2,3,4,1,0,1,0,3,2,3,4,0],tc:[2,4,4,2,0,0,0,1,2,2,3,4,2,0,0,0,3,4,0,4,1],td:[2,0,0,2,0,0,0,1,2,2,3,4,2,4,4,0,3,4,0,4,1],te:[2,0,0,2,0,0,0,1,2,2,3,4,2,0,0,0,3,4,4,4,1]},bar_flag:{hz:[1,0,1,2,3,0,0,1,2,3,0,1,2,3,4,2,1,4,3,0,1],nr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],jr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],rr:[1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4,0],ba:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],bb:[0,1,2,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,4],sa:[3,4,4,2,0,0,0,1,2,3,4,1,2,3,4,2,1,0,1,0,1],sb:[3,4,4,2,0,0,0,1,2,3,4,1,2,3,4,2,1,0,1,0,1],ca:[2,0,1,2,0,0,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],cb:[2,0,1,2,0,0,0,1,2,3,0,1,2,3,4,1,2,3,4,0,1],ta:[2,3,4,1,0,0,1,1,2,4,4,4,2,0,1,0,3,2,3,0,1],tb:[2,3,0,1,2,0,1,1,2,2,3,4,2,0,1,0,3,2,3,4,1],tc:[2,3,4,1,0,0,1,1,2,2,3,4,2,0,1,0,3,2,3,0,1],td:[2,3,0,1,2,0,1,1,2,2,3,4,2,3,4,0,3,2,3,0,1],te:[2,3,0,1,2,0,1,1,2,2,3,4,2,0,1,0,3,2,3,4,1]}} },
    // 右リール
    right: { img: "reel3.png", data: { hazure:{hz:[0,0,2,2,0,1,2,3,4,0,1,1,3,3,0,1,2,0,1,2,3],nr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],jr:[0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2,3],rr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],ba:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],bb:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],sa:[0,3,0,3,2,1,4,0,4,0,3,4,0,4,0,0,2,2,4,2,1],sb:[0,3,0,3,2,1,4,0,4,0,3,4,0,4,0,0,2,2,4,2,1],ca:[2,3,0,1,2,3,2,3,4,0,1,2,3,0,1,0,1,2,3,2,3],cb:[2,3,0,1,2,3,2,3,4,0,1,2,3,0,1,0,1,2,3,2,3],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},x_flag:{hz:[2,3,4,3,2,1,4,3,1,0,3,0,0,2,2,0,1,0,1,0,3],nr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],jr:[0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2,3],rr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],ba:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],bb:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],sa:[2,3,4,3,2,1,4,3,1,0,3,2,0,4,2,0,1,0,1,0,3],sb:[2,3,4,3,2,1,4,3,1,0,3,2,0,4,2,0,1,0,1,0,3],ca:[2,3,0,1,2,3,2,3,4,0,1,2,3,0,1,0,1,2,3,2,3],cb:[2,3,0,1,2,3,2,3,4,0,1,2,3,0,1,0,1,2,3,2,3],ta:[2,3,4,3,2,0,1,0,3,2,3,4,2,2,0,0,2,0,1,2,1],tb:[2,3,4,3,2,0,1,0,3,2,3,0,2,2,4,4,2,0,1,2,1],tc:[2,3,4,3,2,0,1,0,3,2,3,0,2,2,4,4,2,0,1,2,1],td:[2,3,4,0,1,2,3,4,0,0,1,0,1,2,3,4,0,0,1,2,1],te:[2,3,4,3,2,0,1,0,3,2,3,4,2,2,0,0,2,0,1,2,1]},seven_flag:{hz:[0,1,0,3,2,0,0,0,3,2,3,4,0,1,0,3,2,3,4,2,1],nr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],jr:[0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2,3],rr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],ba:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],bb:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],sa:[0,3,0,3,2,1,4,0,1,2,3,4,0,4,0,0,2,2,4,2,1],sb:[0,3,0,3,2,1,4,0,1,2,3,4,0,4,0,0,2,2,4,2,1],ca:[2,3,0,1,2,3,1,0,1,2,3,4,3,0,1,0,1,2,3,2,3],cb:[2,3,0,1,2,3,1,0,1,2,3,4,3,0,1,0,1,2,3,2,3],ta:[2,3,0,3,2,0,1,0,3,2,3,4,2,2,0,0,2,3,2,0,1],tb:[1,2,2,3,0,0,1,0,1,2,3,4,3,2,3,4,3,1,1,3,0],tc:[2,3,0,3,2,0,1,0,1,2,3,4,2,2,4,4,2,3,2,2,1],td:[2,3,0,3,2,0,1,0,3,2,1,0,2,2,4,4,1,3,3,2,1],te:[2,3,0,3,2,0,1,0,3,2,3,4,2,2,0,0,2,3,3,2,1]},bar_flag:{hz:[2,3,0,1,0,1,2,0,1,2,3,4,0,1,0,3,2,3,4,0,1],nr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],jr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],rr:[3,0,1,2,3,0,1,2,3,4,0,1,2,0,1,2,3,4,0,1,2],ba:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],bb:[2,3,0,1,2,3,4,0,1,2,3,0,1,2,3,0,1,2,3,0,1],sa:[2,3,0,1,0,1,2,0,1,2,3,4,0,1,0,3,2,3,4,0,1],sb:[2,3,0,1,0,1,2,0,1,2,3,4,0,1,0,3,2,3,4,0,1],ca:[2,3,0,1,2,3,2,3,4,0,1,2,3,0,1,0,1,2,3,2,3],cb:[2,3,0,1,2,3,2,3,4,0,1,2,3,0,1,0,1,2,3,2,3],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)}} }
};

const mod = (n, m) => ((n % m) + m) % m;
let currentStop = 'left', currentState = 'hazure', currentBottomIdx = 0, solvedTable = {};

function buildTable() {
    solvedTable = {};
    const side = MASTER_STORE[currentStop];
    for (const state in side.data) {
        solvedTable[state] = Array.from({length: 21}, () => ({}));
        FLAGS.forEach(f => {
            const rawData = side.data[state][f.k];
            rawData.forEach((slip, pushIdx) => {
                if (slip === null) return;
                let stopIdx;
                if (currentStop === 'left') {
                    // 左リール専用逆引きロジック
                    let n = 21 - pushIdx; 
                    let low = (n === 1) ? 21 : n - 1;
                    stopIdx = mod(low + slip + 1, 21);
                } else if (currentStop === 'middle') {
                    // 中リール専用ロジック
                    stopIdx = mod(pushIdx - slip - 1, 21);
                } else {
                    // 右リール専用ロジック
                    stopIdx = mod(pushIdx - slip, 21);
                }
                if (!solvedTable[state][stopIdx][f.k]) solvedTable[state][stopIdx][f.k] = [];
                solvedTable[state][stopIdx][f.k].push(slip);
            });
        });
    }
}

function update() {
    const list = document.getElementById('flag-list'); list.innerHTML = '';
    const items = solvedTable[currentState][currentBottomIdx];
    if (items) {
        FLAGS.forEach(f => {
            if (items[f.k]) {
                const slips = [...new Set(items[f.k])].sort((a,b)=>b-a);
                const row = document.createElement('div');
                row.className = `flag-item c-${f.c}`;
                row.innerHTML = `<div class="flag-name">${f.n}</div><div class="flag-data">${slips.map(s=>`[${s}]`).join('')}</div>`;
                list.appendChild(row);
            }
        });
    }
    const win = document.getElementById('reel-window');
    win.style.transform = `translate3d(0, -${(mod(currentBottomIdx - 2, 21) + 21) * 70}px, 0)`;
}

function switchStop(side) {
    currentStop = side;
    document.querySelectorAll('.stop-tab').forEach(t => t.classList.toggle('active', t.id === 'stop-' + side));
    const img = MASTER_STORE[side].img;
    document.querySelectorAll('.symbol-image').forEach(s => s.style.backgroundImage = `url('${img}')`);
    buildTable(); 
    update();
}

function switchState(s) {
    currentState = s;
    document.querySelectorAll('.state-tab').forEach(t => t.classList.toggle('active', t.id === 'tab-' + s));
    update();
}

function init() {
    const win = document.getElementById('reel-window');
    for (let l = 0; l < 3; l++) { for (let i = 0; i < 21; i++) {
        const n = 21 - i;
        win.innerHTML += `<div class="symbol"><div class="index-num">${n}</div><div class="symbol-image" style="background-position:0% ${(21-n)*5}%"></div></div>`;
    } }
    const area = document.getElementById('reel-touch-area'); 
    let isD = false, sy = 0, si = 0;
    const st = (y) => { isD = true; sy = y; si = currentBottomIdx; };
    const mv = (y) => { if (!isD) return; currentBottomIdx = mod(si - Math.round((y - sy) / 70), 21); update(); };
    area.onmousedown = e => st(e.pageY); window.onmousemove = e => mv(e.pageY); window.onmouseup = () => isD = false;
    area.addEventListener('touchstart', e => { st(e.touches[0].pageY); e.preventDefault(); }, {passive: false});
    area.addEventListener('touchmove', e => { mv(e.touches[0].pageY); e.preventDefault(); }, {passive: false});
    area.addEventListener('touchend', () => isD = false);
    switchStop('left'); 
}
init();
</script>
</body>
</html>