<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Versus Revise - Absolute Reverse Auditor</title>
    <style>
        * { box-sizing: border-box; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; }
        
        .stop-tabs { display: flex; width: calc(100% - 10px); background: #000; border: 1px solid #444; border-radius: 8px; margin: 5px; flex-shrink: 0; overflow: hidden; }
        .stop-tab { flex: 1; text-align: center; padding: 12px 0; font-size: 13px; font-weight: 900; cursor: pointer; border-right: 1px solid #222; opacity: 0.35; filter: grayscale(0.5); }
        .stop-tab.active { opacity: 1; filter: grayscale(0); box-shadow: inset 0 0 12px rgba(255,255,255,0.5); }
        #stop-left { background: #ffb7ce; color: #a01040; }   
        #stop-middle { background: #b3e5fc; color: #01579b; } 
        #stop-right { background: #c8e6c9; color: #1b5e20; }  

        .state-tabs { display: flex; width: calc(100% - 10px); height: 55px; flex-shrink: 0; background: #222; border: 1px solid #444; border-radius: 4px; overflow: hidden; margin: 0 5px 5px 5px; }
        .state-tab { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; opacity: 0.6; text-align: center; }
        .state-tab.active { opacity: 1; border-bottom: 4px solid #fff; }
        #tab-hazure { background: #ffffff; color: #000; }
        #tab-x_flag { background: #304ffe; color: #fff; }
        #tab-seven_flag { background: #d50000; color: #fff; }
        #tab-bar_flag { background: #111; color: #fff; }

        .main-content { display: flex; flex-direction: row-reverse; flex: 1; overflow: hidden; gap: 4px; padding: 0 5px 5px 5px; }
        .reel-frame { width: 100px; height: 490px; background: #000; border: 2px solid #444; border-radius: 8px; overflow: hidden; flex-shrink: 0; position: relative; touch-action: none; }
        #reel-window { position: absolute; width: 100%; top: 0; left: 0; pointer-events: none; }
        .symbol { height: 70px; display: flex; border-bottom: 1px solid #1a1a1a; width: 100%; box-sizing: border-box; }
        .index-num { width: 20px; color: #ffd700; text-align: center; font-size: 9px; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .symbol-image { flex: 1; height: 100%; background-size: 100% 2100%; background-repeat: repeat-y; }
        .guide-box { position: absolute; top: 140px; left: 0; width: 100%; height: 210px; border: 3px solid #ff0000; background: rgba(255, 0, 0, 0.05); pointer-events: none; z-index: 10; box-shadow: inset 0 0 10px rgba(255, 0, 0, 0.3); }

        .result-area { flex: 1; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; overflow-y: auto; display: flex; flex-direction: column; }
        .flag-item { display: flex; align-items: center; min-height: 40px; padding: 0 6px; border-bottom: 1px solid #222; border-left: 5px solid rgba(0,0,0,0.5); }
        .flag-name { font-size: 11px; font-weight: bold; width: 65px; flex-shrink: 0; }
        .flag-data { font-size: 12px; color: #fff; font-family: monospace; text-align: right; flex: 1; word-spacing: -2px; }

        .c-rep { border-left-color: #00ccff; color: #00ccff; background: rgba(0, 204, 255, 0.08); } 
        .c-bell { border-left-color: #eeee00; color: #eeee00; background: rgba(238, 238, 0, 0.08); } 
        .c-suika { border-left-color: #00ff66; color: #00ff66; background: rgba(0, 255, 102, 0.08); } 
        .c-cher { border-left-color: #ff0066; color: #ff0066; background: rgba(255, 0, 102, 0.08); }
        .c-hazure { border-left-color: #888888; color: #cccccc; background: rgba(136, 136, 136, 0.08); }
        .c-tok { border-left-color: #cc33ff; color: #cc33ff; background: rgba(204, 51, 255, 0.08); }
    </style>
</head>
<body>
    <div class="stop-tabs">
        <div id="stop-left" class="stop-tab active" onclick="switchStop('left')">左リール</div>
        <div id="stop-middle" class="stop-tab" onclick="switchStop('middle')">中リール</div>
        <div id="stop-right" class="stop-tab" onclick="switchStop('right')">右リール</div>
    </div>
    <div class="state-tabs">
        <div id="tab-hazure" class="state-tab active" onclick="switchState('hazure')">ボーナス未成立</div>
        <div id="tab-x_flag" class="state-tab" onclick="switchState('x_flag')">Ｘビッグ成立</div>
        <div id="tab-seven_flag" class="state-tab" onclick="switchState('seven_flag')">７ビッグ成立</div>
        <div id="tab-bar_flag" class="state-tab" onclick="switchState('bar_flag')">Reg成立</div>
    </div>
    <div class="main-content">
        <div id="reel-touch-area" class="reel-frame">
            <div class="guide-box"></div><div id="reel-window"></div>
        </div>
        <div class="result-area"><div id="flag-list"></div></div>
    </div>

<script>
// ==========================================
// 【神のデータ：修正厳禁】
// ==========================================
const n = null;
const MASTER_STORE = {
    left: {
        img: "reel1.png",
        hazure: {hz:[2,2,4,4,0,1,1,1,0,1,0,1,2,3,0,1,0,1,2,0,0],nr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],jr:[1,2,0,1,2,3,0,0,2,2,4,2,3,4,2,3,0,1,1,3,3],rr:[0,1,2,3,4,0,0,1,1,2,0,1,2,3,4,0,0,1,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],sa:[2,1,4,3,0,0,1,1,4,0,2,2,4,4,0,1,1,2,2,3,1],sb:[2,1,4,3,0,0,1,1,4,0,2,2,4,4,0,1,1,2,2,3,1],ca:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,1,2,3],cb:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,1,2,3],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},
        x_flag: {hz:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0],nr:[0,1,2,3,4,0,1,2,3,4,0,4,2,3,4,0,1,0,3,2,3],jr:[0,2,2,4,0,0,1,1,0,0,2,1,4,3,0,1,1,2,4,0,1],rr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[1,1,2,4,0,1,1,2,4,0,2,4,2,4,0,1,2,3,4,2,1],sa:[2,3,4,4,0,1,2,3,4,0,2,2,4,4,0,1,0,1,2,3,1],sb:[2,3,4,4,0,1,2,3,4,0,2,2,4,4,0,1,0,1,2,3,1],ca:[4,0,1,0,1,2,3,4,4,1,2,0,1,0,1,2,3,4,1,2,3],cb:[4,0,1,0,1,2,3,4,4,1,2,0,1,0,1,2,3,4,1,2,3],ta:[2,2,4,4,0,1,2,3,4,1,2,2,4,4,0,1,0,0,0,0,0],tb:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0],tc:[2,2,4,4,0,1,2,3,4,1,2,2,4,4,0,1,0,0,0,0,0],td:[1,4,3,4,0,1,2,3,4,2,2,2,2,4,0,0,0,1,1,3,3],te:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0]},
        seven_flag: {hz:[1,0,1,0,1,2,2,2,4,4,2,1,0,2,2,n,n,n,n,n,n],nr:[1,1,1,1,1,2,1,1,0,0,1,3,1,3,3,n,n,n,n,n,n],jr:[1,0,1,0,1,2,2,2,4,4,2,1,0,2,2,n,n,n,n,n,n],rr:[3,3,1,3,3,4,3,3,0,0,3,4,3,4,4,n,n,n,n,n,n],ba:[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0,n,n,n,n,n,n],bb:[1,0,1,0,0,1,0,0,2,2,0,1,1,1,1,n,n,n,n,n,n],sa:[0,1,4,1,2,1,1,1,3,3,1,0,2,2,2,n,n,n,n,n,n],sb:[0,0,2,0,1,1,1,1,4,4,1,0,1,1,1,n,n,n,n,n,n],ca:[0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,n,n,n,n,n,n],cb:[1,2,0,2,1,1,0,0,1,1,0,1,0,0,0,n,n,n,n,n,n],ta:[1,0,1,0,1,0,2,2,2,2,2,1,1,1,1,n,n,n,n,n,n],tb:[1,1,2,1,1,1,2,2,0,0,2,1,2,2,2,n,n,n,n,n,n],tc:[3,2,0,2,3,2,4,4,1,1,4,3,3,3,3,n,n,n,n,n,n],td:[3,3,4,3,3,3,4,4,0,0,4,3,4,4,4,n,n,n,n,n,n],te:[4,4,4,4,4,0,0,0,1,1,0,4,0,4,4,n,n,n,n,n,n]},
        bar_flag: {hz:[1,0,0,0,1,1,2,2,4,4,0,2,0,2,2,n,n,n,n,n,n],nr:[1,1,1,1,1,1,1,1,0,0,1,3,1,2,3,n,n,n,n,n,n],jr:[3,2,2,2,3,2,4,4,1,1,3,3,3,4,3,n,n,n,n,n,n],rr:[3,3,3,3,3,4,3,3,0,0,3,4,3,4,4,n,n,n,n,n,n],ba:[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0,n,n,n,n,n,n],bb:[1,0,0,0,0,1,0,0,2,2,1,1,1,1,1,n,n,n,n,n,n],sa:[0,1,1,1,2,1,1,1,3,3,2,2,2,2,2,n,n,n,n,n,n],sb:[0,0,0,0,1,2,1,1,4,4,1,1,1,3,1,n,n,n,n,n,n],ca:[0,1,1,1,1,4,0,0,0,0,0,0,0,0,0,n,n,n,n,n,n],cb:[1,2,2,2,1,0,0,0,1,1,0,0,0,1,0,n,n,n,n,n,n],ta:[1,0,0,0,1,0,2,2,2,2,1,1,1,0,1,n,n,n,n,n,n],tb:[1,1,1,1,1,4,2,2,0,0,2,2,2,2,2,n,n,n,n,n,n],tc:[3,2,2,2,3,2,4,4,1,1,3,3,3,3,3,n,n,n,n,n,n],td:[3,3,3,3,3,3,4,4,0,0,4,4,4,3,4,n,n,n,n,n,n],te:[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0,n,n,n,n,n,n]}
    },
    middle: {
        img: "reel2.png",
        hazure: {hz:[0,3,0,3,2,2,0,0,2,2,n,n,n,n,n,n,n,n,n,n,n],nr:[0,0,1,0,3,3,3,3,3,3,n,n,n,n,n,n,n,n,n,n,n],jr:[2,1,2,1,0,0,0,0,0,0,n,n,n,n,n,n,n,n,n,n,n],rr:[2,2,3,2,1,1,3,3,1,1,n,n,n,n,n,n,n,n,n,n,n],ba:[0,3,0,3,2,2,2,2,2,2,n,n,n,n,n,n,n,n,n,n,n],bb:[1,0,1,0,3,3,1,1,3,3,n,n,n,n,n,n,n,n,n,n,n],sa:[2,1,2,1,4,4,4,4,2,2,n,n,n,n,n,n,n,n,n,n,n],sb:[3,2,3,2,0,0,0,0,3,3,n,n,n,n,n,n,n,n,n,n,n],ca:[4,3,4,3,1,1,4,4,4,4,n,n,n,n,n,n,n,n,n,n,n],cb:[0,3,0,3,2,2,0,0,2,2,n,n,n,n,n,n,n,n,n,n,n],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},
        x_flag: {hz:[2,3,0,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],nr:[3,0,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],jr:[4,1,2,1,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4],rr:[3,2,3,2,1,1,3,3,1,1,3,3,3,0,3,3,3,3,3,3,3],ba:[2,3,0,3,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2],bb:[1,0,1,0,3,3,1,1,3,3,0,0,0,2,0,0,0,0,0,0,0],sa:[4,1,2,1,4,4,4,4,2,2,1,1,1,3,1,1,1,1,1,1,1],sb:[3,2,3,2,0,0,3,3,3,3,0,0,0,4,0,0,0,0,0,0,0],ca:[1,3,4,3,1,1,1,1,4,4,3,3,3,0,3,3,3,3,3,3,3],cb:[0,4,0,4,2,2,0,0,0,0,2,2,2,0,2,2,2,2,2,2,2],ta:[3,0,1,0,3,3,3,3,1,1,3,3,3,1,3,3,3,3,3,3,3],tb:[0,1,2,1,0,0,2,2,2,2,4,0,0,0,4,4,0,0,0,0,0],tc:[0,2,0,2,1,1,0,0,3,3,2,2,2,1,2,2,2,2,2,2,2],td:[2,0,1,0,2,2,4,4,0,0,2,2,2,2,2,2,2,2,2,2,2],te:[2,1,2,1,3,3,2,2,1,1,0,4,4,3,0,0,4,4,4,4,4]},
        seven_flag: {hz:[0,3,0,3,2,2,0,0,2,2,2,1,2,2,2,n,n,n,n,n,n],nr:[1,0,1,0,3,3,3,3,3,3,3,2,3,3,3,n,n,n,n,n,n],jr:[0,1,2,1,0,0,0,0,0,0,0,2,0,0,0,n,n,n,n,n,n],rr:[3,2,3,2,1,1,3,3,1,1,3,3,3,3,3,n,n,n,n,n,n],ba:[2,3,0,3,2,2,2,2,2,2,2,0,2,2,2,n,n,n,n,n,n],bb:[0,0,1,0,3,3,1,1,3,3,0,0,0,0,0,n,n,n,n,n,n],sa:[0,1,2,1,4,4,4,4,1,1,1,1,1,1,1,n,n,n,n,n,n],sb:[0,2,3,2,0,0,0,0,0,0,0,0,0,0,0,n,n,n,n,n,n],ca:[3,3,4,3,1,1,1,1,1,1,3,1,1,3,3,n,n,n,n,n,n],cb:[2,4,0,4,2,2,2,2,2,2,2,2,2,2,2,n,n,n,n,n,n],ta:[3,0,1,0,3,3,3,3,3,3,3,3,3,1,3,n,n,n,n,n,n],tb:[4,1,2,1,0,0,4,4,4,4,4,4,4,0,4,n,n,n,n,n,n],tc:[0,2,0,2,1,1,0,0,3,3,2,3,2,2,2,n,n,n,n,n,n],td:[1,0,1,0,2,2,4,4,0,0,2,2,2,2,2,n,n,n,n,n,n],te:[0,1,2,1,3,3,0,0,1,1,0,3,4,4,0,n,n,n,n,n,n]},
        bar_flag: {hz:[2,3,3,3,2,2,2,2,2,2,0,0,0,0,0,n,n,n,n,n,n],nr:[3,0,0,0,3,3,3,3,3,3,1,1,1,1,1,n,n,n,n,n,n],jr:[0,1,1,1,0,0,0,0,0,0,2,2,2,2,2,n,n,n,n,n,n],rr:[1,2,2,2,1,1,1,1,1,1,3,3,3,3,3,n,n,n,n,n,n],ba:[0,3,3,3,2,2,0,0,2,2,0,0,0,0,0,n,n,n,n,n,n],bb:[1,0,0,0,3,3,1,1,3,3,1,1,1,1,1,n,n,n,n,n,n],sa:[2,1,1,1,4,4,2,2,2,2,1,1,1,1,1,n,n,n,n,n,n],sb:[0,2,2,2,0,0,0,0,3,3,0,0,0,0,0,n,n,n,n,n,n],ca:[1,3,3,3,1,1,1,1,4,4,1,1,1,1,1,n,n,n,n,n,n],cb:[2,4,4,4,2,2,2,2,0,0,2,2,2,0,2,n,n,n,n,n,n],ta:[3,0,0,0,3,3,3,3,1,1,3,3,3,1,3,n,n,n,n,n,n],tb:[4,1,1,1,0,0,4,4,2,2,4,4,4,2,4,n,n,n,n,n,n],tc:[0,2,2,2,1,1,0,0,3,3,0,3,3,3,0,n,n,n,n,n,n],td:[1,0,0,0,2,2,1,1,0,0,1,3,3,3,1,n,n,n,n,n,n],te:[0,1,1,1,3,3,0,0,1,1,0,4,4,4,0,n,n,n,n,n,n]}
    },
    right: {
        img: "reel3.png",
        hazure: {hz:[2,1,1,1,0,0,2,2,2,2,n,n,n,n,n,n,n,n,n,n,n],nr:[0,2,2,2,1,1,3,3,0,0,n,n,n,n,n,n,n,n,n,n,n],jr:[1,0,0,0,2,2,4,4,1,1,n,n,n,n,n,n,n,n,n,n,n],rr:[2,1,1,1,0,0,2,2,2,2,n,n,n,n,n,n,n,n,n,n,n],ba:[0,2,2,2,1,1,0,0,0,0,n,n,n,n,n,n,n,n,n,n,n],bb:[1,3,3,3,2,2,0,0,1,1,n,n,n,n,n,n,n,n,n,n,n],sa:[0,4,4,4,3,3,0,0,0,0,n,n,n,n,n,n,n,n,n,n,n],sb:[3,0,0,0,4,4,2,2,1,1,n,n,n,n,n,n,n,n,n,n,n],ca:[2,1,1,1,0,0,2,2,2,2,n,n,n,n,n,n,n,n,n,n,n],cb:[3,2,2,2,1,1,4,4,3,3,n,n,n,n,n,n,n,n,n,n,n],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},
        x_flag: {hz:[0,1,1,1,0,0,2,2,2,2,2,2,2,1,2,n,n,n,n,n,n],nr:[3,2,2,2,1,1,3,3,0,0,4,0,4,0,0,n,n,n,n,n,n],jr:[2,0,0,0,2,2,4,4,1,1,4,0,4,1,0,n,n,n,n,n,n],rr:[1,1,1,1,0,0,1,1,2,2,2,2,2,1,2,n,n,n,n,n,n],ba:[1,2,2,2,1,1,0,0,0,0,0,0,0,0,0,n,n,n,n,n,n],bb:[2,3,3,3,2,2,0,0,1,1,1,0,1,0,1,n,n,n,n,n,n],sa:[1,4,4,4,3,3,1,1,0,0,0,0,0,0,0,n,n,n,n,n,n],sb:[4,0,0,0,4,4,2,2,1,1,3,1,3,1,3,n,n,n,n,n,n],ca:[0,1,1,1,0,0,2,2,2,2,4,2,4,1,4,n,n,n,n,n,n],cb:[4,2,2,2,1,1,4,4,3,3,4,2,2,3,0,n,n,n,n,n,n],ta:[2,3,3,3,2,2,4,4,0,0,4,3,3,3,1,n,n,n,n,n,n],tb:[1,0,0,0,3,3,1,1,1,1,2,4,4,4,2,n,n,n,n,n,n],tc:[0,1,1,1,0,0,0,0,2,2,2,2,2,2,2,n,n,n,n,n,n],td:[0,2,2,2,1,1,0,0,3,3,0,0,0,0,0,n,n,n,n,n,n],te:[0,3,3,3,2,2,0,0,4,4,0,0,0,0,0,n,n,n,n,n,n]},
        seven_flag: {hz:[3,1,1,1,0,0,2,2,2,2,2,4,2,2,2,n,n,n,n,n,n],nr:[0,2,2,2,1,1,3,3,0,0,4,2,4,0,0,n,n,n,n,n,n],jr:[1,0,0,0,2,2,4,4,1,1,4,1,4,0,0,n,n,n,n,n,n],rr:[2,1,1,1,0,0,2,2,2,2,2,1,2,2,2,n,n,n,n,n,n],ba:[3,2,2,2,1,1,0,0,0,0,0,2,0,0,0,n,n,n,n,n,n],bb:[0,3,3,3,2,2,0,0,0,0,0,0,0,0,0,n,n,n,n,n,n],sa:[0,4,4,4,3,3,0,0,0,0,0,0,0,0,0,n,n,n,n,n,n],sb:[2,0,0,0,4,4,2,2,1,1,1,0,1,1,1,n,n,n,n,n,n],ca:[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2,n,n,n,n,n,n],cb:[3,2,2,2,1,1,4,4,3,3,4,2,2,2,2,n,n,n,n,n,n],ta:[4,3,3,3,2,2,4,4,0,0,4,3,3,3,3,n,n,n,n,n,n],tb:[4,0,0,0,3,3,4,4,1,1,4,4,4,4,4,n,n,n,n,n,n],tc:[2,1,1,1,0,0,2,2,2,2,2,1,2,2,2,n,n,n,n,n,n],td:[3,2,2,2,1,1,0,0,3,3,0,0,0,4,0,n,n,n,n,n,n],te:[4,3,3,3,2,2,0,0,4,4,0,1,0,4,0,n,n,n,n,n,n]},
        bar_flag: {hz:[1,1,1,1,0,0,3,3,2,2,2,2,2,2,2,n,n,n,n,n,n],nr:[0,2,2,2,1,1,4,4,0,0,3,3,3,3,3,n,n,n,n,n,n],jr:[1,0,0,0,2,2,4,4,1,1,4,0,4,0,0,n,n,n,n,n,n],rr:[2,1,1,1,0,0,2,2,2,2,1,1,1,1,1,n,n,n,n,n,n],ba:[3,2,2,2,1,1,0,0,0,0,0,2,0,2,2,n,n,n,n,n,n],bb:[0,3,3,3,2,2,0,0,0,0,0,0,0,0,0,n,n,n,n,n,n],sa:[0,4,4,4,3,3,0,0,0,0,1,1,1,1,1,n,n,n,n,n,n],sb:[1,0,0,0,4,4,1,1,1,1,1,1,1,1,1,n,n,n,n,n,n],ca:[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2,n,n,n,n,n,n],cb:[3,2,2,2,1,1,3,3,3,3,4,2,2,2,2,n,n,n,n,n,n],ta:[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2,n,n,n,n,n,n],tb:[3,2,2,2,1,1,3,3,3,3,0,0,0,3,0,n,n,n,n,n,n],tc:[4,3,3,3,2,2,4,4,4,4,1,1,1,4,1,n,n,n,n,n,n],td:[2,0,0,0,3,3,2,2,1,1,0,0,0,0,0,n,n,n,n,n,n],te:[1,1,1,1,0,0,1,1,2,2,1,1,1,1,1,n,n,n,n,n,n]}
    }
};

const FLAGS = [
    {k:"hz",n:"ハズレ",c:"hazure"},{k:"nr",n:"通常リプ",c:"rep"},{k:"jr",n:"JACリプ",c:"rep"},{k:"rr",n:"RTリプ",c:"rep"},
    {k:"ba",n:"ベルA",c:"bell"},{k:"bb",n:"ベルB",c:"bell"},{k:"sa",n:"スイカA",c:"suika"},{k:"sb",n:"スイカB",c:"suika"},
    {k:"ca",n:"チェリーA",c:"cher"},{k:"cb",n:"チェリーB",c:"cher"},{k:"ta",n:"特殊役A",c:"tok"},{k:"tb",n:"特殊役B",c:"tok"},
    {k:"tc",n:"特殊役C",c:"tok"},{k:"td",n:"特殊役D",c:"tok"},{k:"te",n:"特殊役E",c:"tok"}
];
const mod = (n, m) => ((n % m) + m) % m;
const REEL_LEN = 21;

// 下段停止位置 (#21=0, #1=20)
let currentBottomIdx = 10; // 初期：#11
let currentState = 'hazure', currentStop = 'left';

/**
 * 【真・逆引き監査エンジン】
 * 全押し位置(P)に対してスベリ(L)を実施し、最終停止位置(S)に合致するものを全抽出。
 * 加算方向に滑るため、インデックスは引き算になる。
 */
function update() {
    const list = document.getElementById('flag-list');
    list.innerHTML = '';
    const side = MASTER_STORE[currentStop];
    const dataSet = side[currentState];
    
    // 現在の下段位置 S (インデックス)
    const S = currentBottomIdx;

    FLAGS.forEach(f => {
        const rawSlips = dataSet[f.k];
        if (!rawSlips) return;
        
        let foundResults = [];
        // 1. 全配列番号 P (0..20) を「ストップボタン押下位置」としてループ実施
        for (let P = 0; P < REEL_LEN; P++) {
            const L = rawSlips[P];
            if (L === null) continue;
            
            // 2. 物理法則：押し位置 P(記号) + スベリ L = 停止位置 S(記号)
            // 配列インデックスにおいては「減算」が「記号番号の加算」に相当する。
            if (mod(P - L, REEL_LEN) === S) {
                // 一致した場合、その時の押し位置（記号番号 #21..1）とスベリを記録
                foundResults.push({ pushNum: 21 - P, slip: L });
            }
        }

        if (foundResults.length > 0) {
            const row = document.createElement('div');
            row.className = `flag-item c-${f.c}`;
            
            // 監査結果を表示（狙い位置の降順）
            const dataStr = foundResults
                .sort((a, b) => b.pushNum - a.pushNum)
                .map(r => `#${r.pushNum}(${r.slip})`)
                .join(' ');
            
            row.innerHTML = `<div class="flag-name">${f.n}</div><div class="flag-data">${dataStr}</div>`;
            list.appendChild(row);
        }
    });

    // リール物理座標同期描画
    const win = document.getElementById('reel-window');
    const visualY = 280 - (currentBottomIdx + REEL_LEN) * 70;
    win.style.transform = `translate3d(0, ${visualY}px, 0)`;
}

function switchStop(side) {
    currentStop = side;
    document.querySelectorAll('.stop-tab').forEach(t => t.classList.toggle('active', t.id === 'stop-' + side));
    const img = MASTER_STORE[side].img;
    document.querySelectorAll('.symbol-image').forEach(s => s.style.backgroundImage = `url('${img}')`);
    update();
}

function switchState(s) {
    currentState = s;
    document.querySelectorAll('.state-tab').forEach(t => t.classList.toggle('active', t.id === 'tab-' + s));
    update();
}

function init() {
    const win = document.getElementById('reel-window');
    win.innerHTML = ''; 
    for (let l = 0; l < 3; l++) { 
        for (let i = 0; i < REEL_LEN; i++) {
            const nNum = 21 - i;
            const d = document.createElement('div');
            d.className = 'symbol';
            d.innerHTML = `<div class="index-num">${nNum}</div><div class="symbol-image" style="background-position:0% ${(21-nNum)*5}%"></div>`;
            win.appendChild(d);
        }
    }
    const area = document.getElementById('reel-touch-area'); 
    let isDragging = false, startY = 0, initialIdx = 0;
    const onStart = (y) => { isDragging = true; startY = y; initialIdx = currentBottomIdx; };
    const onMove = (y) => { 
        if (!isDragging) return; 
        const delta = Math.round((y - startY) / 70);
        // ドラッグ下方向(delta正)でインデックスが増える(記号番号が減る)ように同期
        currentBottomIdx = mod(initialIdx - delta, REEL_LEN); 
        update(); 
    };
    area.onmousedown = e => onStart(e.pageY);
    window.onmousemove = e => onMove(e.pageY);
    window.onmouseup = () => isDragging = false;
    area.addEventListener('touchstart', e => { onStart(e.touches[0].pageY); e.preventDefault(); }, {passive: false});
    area.addEventListener('touchmove', e => { onMove(e.touches[0].pageY); e.preventDefault(); }, {passive: false});
    area.addEventListener('touchend', () => isDragging = false);

    switchStop('left'); 
}
init();
</script>
</body>
</html>