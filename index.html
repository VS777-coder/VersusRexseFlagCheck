<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Versus Revise - Absolute Reverse Auditor</title>
    <style>
        * { box-sizing: border-box; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; }
        
        .stop-tabs { display: flex; width: calc(100% - 10px); background: #000; border: 1px solid #444; border-radius: 8px; margin: 5px; flex-shrink: 0; overflow: hidden; }
        .stop-tab { flex: 1; text-align: center; padding: 12px 0; font-size: 13px; font-weight: 900; cursor: pointer; border-right: 1px solid #222; opacity: 0.35; filter: grayscale(0.5); }
        .stop-tab.active { opacity: 1; filter: grayscale(0); box-shadow: inset 0 0 12px rgba(255,255,255,0.5); }
        #stop-left { background: #600010; color: #ffb7ce; }   
        #stop-middle { background: #001040; color: #b3e5fc; } 
        #stop-right { background: #002005; color: #c8e6c9; }  

        .state-tabs { display: flex; width: calc(100% - 10px); height: 55px; flex-shrink: 0; background: #222; border: 1px solid #444; border-radius: 4px; overflow: hidden; margin: 0 5px 5px 5px; }
        .state-tab { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; opacity: 0.6; text-align: center; }
        .state-tab.active { opacity: 1; border-bottom: 4px solid #fff; }
        #tab-hazure { background: #ffffff; color: #000; }
        #tab-x_flag { background: #304ffe; color: #fff; }
        #tab-seven_flag { background: #d50000; color: #fff; }
        #tab-bar_flag { background: #111; color: #fff; }

        .main-content { display: flex; flex-direction: row-reverse; flex: 1; overflow: hidden; gap: 4px; padding: 0 5px 5px 5px; }
        .reel-frame { width: 100px; height: 490px; background: #111; border: 2px solid #444; border-radius: 8px; overflow: hidden; flex-shrink: 0; position: relative; touch-action: none; }
        #reel-window { position: absolute; width: 100%; top: 0; left: 0; pointer-events: none; }
        .symbol { height: 70px; display: flex; border-bottom: 1px solid #1a1a1a; width: 100%; box-sizing: border-box; }
        .index-num { width: 20px; color: #ffd700; text-align: center; font-size: 10px; font-weight: bold; display: flex; align-items: center; justify-content: center; background: #000; }
        .symbol-image { flex: 1; height: 100%; background-size: 100% 2100%; background-repeat: repeat-y; }
        .guide-box { position: absolute; top: 140px; left: 0; width: 100%; height: 210px; border: 3px solid #00bbff; background: rgba(0, 187, 255, 0.05); pointer-events: none; z-index: 10; box-shadow: inset 0 0 15px rgba(0, 187, 255, 0.3); }

        .result-area { flex: 1; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; overflow-y: auto; display: flex; flex-direction: column; }
        .flag-item { display: flex; align-items: center; min-height: 45px; padding: 0 8px; border-bottom: 1px solid #222; border-left: 5px solid rgba(0,0,0,0.5); }
        .flag-name { font-size: 11px; font-weight: bold; width: 65px; flex-shrink: 0; }
        .flag-data { font-size: 13px; color: #fff; font-family: monospace; text-align: right; flex: 1; word-spacing: 2px; }

        .c-rep { border-left-color: #00ccff; color: #00ccff; background: rgba(0, 204, 255, 0.08); } 
        .c-bell { border-left-color: #eeee00; color: #eeee00; background: rgba(238, 238, 0, 0.08); } 
        .c-suika { border-left-color: #00ff66; color: #00ff66; background: rgba(0, 255, 102, 0.08); } 
        .c-cher { border-left-color: #ff0066; color: #ff0066; background: rgba(255, 0, 102, 0.08); }
        .c-hazure { border-left-color: #888888; color: #cccccc; background: rgba(136, 136, 136, 0.08); }
        .c-tok { border-left-color: #cc33ff; color: #cc33ff; background: rgba(204, 51, 255, 0.08); }
    </style>
</head>
<body>
    <div class="stop-tabs">
        <div id="stop-left" class="stop-tab active" onclick="switchStop('left')">左リール</div>
        <div id="stop-middle" class="stop-tab" onclick="switchStop('middle')">中リール</div>
        <div id="stop-right" class="stop-tab" onclick="switchStop('right')">右リール</div>
    </div>
    <div class="state-tabs">
        <div id="tab-hazure" class="state-tab active" onclick="switchState('hazure')">ボーナス未成立</div>
        <div id="tab-x_flag" class="state-tab" onclick="switchState('x_flag')">Ｘビッグ成立</div>
        <div id="tab-seven_flag" class="state-tab" onclick="switchState('seven_flag')">７ビッグ成立</div>
        <div id="tab-bar_flag" class="state-tab" onclick="switchState('bar_flag')">REG成立</div>
    </div>
    <div class="main-content">
        <div id="reel-touch-area" class="reel-frame">
            <div class="guide-box"></div><div id="reel-window"></div>
        </div>
        <div class="result-area"><div id="flag-list"></div></div>
    </div>

<script>
// ==========================================
// 【全状態：提供データに基づく完全定義】
// ==========================================
const n = null;
const RAW_DATA = {
    left: {
        img: "reel1.png",
        hazure: {hz:[2,1,2,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,4,4,4],nr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],jr:[1,2,0,1,2,3,0,0,2,2,4,2,3,4,2,3,0,1,1,3,3],rr:[0,1,2,3,4,0,0,1,1,2,0,1,2,3,4,0,0,1,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],sa:[2,1,4,3,0,0,1,1,4,0,2,2,4,4,0,1,1,2,2,3,1],sb:[2,1,4,3,0,0,1,1,4,0,2,2,4,4,0,1,1,2,2,3,1],ca:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,1,2,3],cb:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,1,2,3],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},
        x_flag: {hz:[2,1,2,1,1,1,3,3,0,0,2,2,2,4,2,3,2,1,2,4,4],nr:[0,1,2,3,4,0,1,2,3,4,0,4,2,3,4,0,1,0,3,2,3],jr:[0,2,2,4,0,0,1,1,0,0,2,1,4,3,0,1,1,2,4,0,1],rr:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3],ba:[1,1,3,3,4,0,2,1,1,1,1,1,3,3,4,1,2,3,1,2,0],bb:[1,1,2,4,0,1,1,2,4,0,2,4,2,4,0,1,2,3,4,2,1],sa:[2,3,4,4,0,1,2,3,4,0,2,2,4,4,0,1,0,1,2,3,1],sb:[2,3,4,4,0,1,2,3,4,0,2,2,4,4,0,1,0,1,2,3,1],ca:[4,0,1,0,1,2,3,4,4,1,2,0,1,0,1,2,3,4,1,2,3],cb:[4,0,1,0,1,2,3,4,4,1,2,0,1,0,1,2,3,4,1,2,3],ta:[2,2,4,4,0,1,2,3,4,1,2,2,4,4,0,1,0,0,0,0,0],tb:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0],tc:[2,2,4,4,0,1,2,3,4,1,2,2,4,4,0,1,0,0,0,0,0],td:[1,4,3,4,0,1,2,3,4,2,2,2,2,4,0,0,0,1,1,3,3],te:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0]},
        seven_flag: {hz:[1,1,1,1,1,2,1,1,0,0,1,3,1,3,3,0,1,0,3,3,4],nr:[1,1,1,1,1,2,1,1,0,0,1,3,1,3,3,1,0,1,3,2,3],jr:[1,0,1,0,1,2,2,2,4,4,2,1,0,2,2,1,1,1,1,1,2],rr:[3,3,1,3,3,4,3,3,0,0,3,4,3,4,4,3,3,4,3,2,4],ba:[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0,0,0,1,4,4,4],bb:[1,0,1,0,0,1,0,0,2,2,0,1,1,1,1,1,1,0,1,2,3],sa:[0,1,4,1,2,1,1,1,3,3,1,0,2,2,2,0,1,1,0,2,1],sb:[0,0,2,0,1,1,1,1,4,4,1,0,1,1,1,0,1,1,2,1,1],ca:[0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1],cb:[1,2,0,2,1,1,0,0,1,1,0,1,0,0,0,1,1,0,2,1,0],ta:[1,0,1,0,1,0,2,2,2,2,2,1,1,1,1,2,1,1,3,2,0],tb:[1,1,2,1,1,1,2,2,0,0,2,1,2,2,2,2,1,2,1,2,1],tc:[3,2,0,2,3,2,4,4,1,1,4,3,3,3,3,4,3,4,1,4,0],td:[3,3,4,3,3,3,4,4,0,0,4,3,4,4,4,4,3,4,3,4,3],te:[4,4,4,4,4,0,0,0,1,1,0,4,0,4,4,4,4,0,4,4,4]},
        bar_flag: {hz:[1,1,1,1,1,1,1,1,0,0,1,3,1,2,3,1,1,1,1,1,1],nr:[1,1,1,1,1,1,1,1,0,0,1,3,1,2,3,1,1,1,1,1,1],jr:[3,2,2,2,3,2,4,4,1,1,3,3,3,4,3,2,2,3,2,2,2],rr:[3,3,3,3,3,4,3,3,0,0,3,4,3,4,4,3,3,4,3,3,3],ba:[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0,0,0,1,4,4,4],bb:[1,0,0,0,0,1,0,0,2,2,1,1,1,1,1,1,1,0,1,2,3],sa:[0,1,1,1,2,1,1,1,3,3,2,2,2,2,2,0,1,1,0,2,1],sb:[0,0,0,0,1,2,1,1,4,4,1,1,1,3,1,0,1,1,2,1,1],ca:[0,1,1,1,1,4,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1],cb:[1,2,2,2,1,0,0,0,1,1,0,0,0,1,0,1,1,0,2,1,0],ta:[1,0,0,0,1,0,2,2,2,2,1,1,1,0,1,2,1,1,3,2,0],tb:[1,1,1,1,1,4,2,2,0,0,2,2,2,2,2,2,1,2,1,2,1],tc:[3,2,2,2,3,2,4,4,1,1,3,3,3,3,3,4,3,4,1,4,0],td:[3,3,3,3,3,3,4,4,0,0,4,4,4,3,4,4,3,4,3,4,3],te:[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0,0,0,1,4,4,4]}
    },
    middle: {
        img: "reel2.png",
        hazure: {hz:[2,1,1,1,0,0,2,2,2,2,1,1,3,3,1,0,2,2,1,0,3],nr:[0,2,2,2,1,1,3,3,0,0,1,1,3,3,1,0,1,1,1,1,0],jr:[1,0,0,0,2,2,4,4,1,1,3,3,1,1,3,2,2,2,1,2,0],rr:[2,1,1,1,0,0,2,2,2,2,3,2,1,1,2,2,2,2,1,2,3],ba:[2,1,1,1,0,0,2,2,2,2,3,1,1,1,1,1,1,1,0,1,2],bb:[3,2,2,2,1,1,4,4,3,3,3,2,1,1,3,2,2,2,1,2,3],sa:[1,3,3,3,2,2,4,4,0,0,2,2,0,0,2,0,1,1,1,2,3],sb:[1,0,0,0,3,3,1,1,1,1,3,3,1,1,1,2,2,2,2,2,1],ca:[3,1,1,1,0,0,2,2,2,2,1,1,1,1,1,2,2,2,2,2,3],cb:[3,2,2,2,1,1,0,0,3,3,3,2,1,1,3,2,2,2,1,2,3],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},
        x_flag: {hz:[0,1,1,1,0,0,2,2,2,2,4,2,4,1,4,4,4,4,4,4,1],nr:[3,2,2,2,1,1,3,3,0,0,4,2,2,3,0,4,4,4,4,4,1],jr:[2,0,0,0,2,2,4,4,1,1,4,3,3,3,1,4,4,4,4,4,1],rr:[1,1,1,1,0,0,1,1,2,2,2,4,4,4,2,1,1,1,2,4,1],ba:[1,2,2,2,1,1,0,0,0,0,2,2,2,2,2,0,0,0,1,4,1],bb:[2,3,3,3,2,2,0,0,1,1,0,0,0,0,0,0,0,0,2,4,1],sa:[1,4,4,4,3,3,1,1,0,0,0,0,0,0,0,0,0,0,1,4,1],sb:[4,0,0,0,4,4,2,2,1,1,0,0,0,2,0,3,3,3,4,4,1],ca:[0,1,1,1,0,0,2,2,2,2,3,3,3,1,3,2,2,2,0,4,1],cb:[4,2,2,2,1,1,4,4,3,3,4,4,4,2,4,4,4,4,1,4,1],ta:[2,3,3,3,2,2,4,4,0,0,4,4,4,3,4,4,4,4,4,4,1],tb:[1,0,0,0,3,3,1,1,1,1,4,4,4,4,4,4,4,4,4,4,1],tc:[2,1,1,1,0,0,2,2,2,2,1,1,1,3,1,2,2,2,4,4,1],td:[3,2,2,2,1,1,0,0,3,3,1,1,1,1,1,4,4,4,2,4,1],te:[4,3,3,3,2,2,0,0,4,4,1,1,1,1,1,4,4,4,4,4,1]},
        seven_flag: {hz:[3,1,1,1,0,0,2,2,2,2,2,4,2,2,2,2,1,2,2,1,2],nr:[0,2,2,2,1,1,3,3,0,0,4,2,4,0,0,4,4,4,4,4,0],jr:[1,0,0,0,2,2,4,4,1,1,4,1,4,0,0,4,4,4,4,4,2],rr:[2,1,1,1,0,0,2,2,2,2,2,1,2,2,2,2,1,2,2,1,2],ba:[3,2,2,2,1,1,0,0,0,0,0,2,0,0,0,2,1,2,2,1,0],bb:[0,3,3,3,2,2,0,0,0,0,0,0,0,0,0,4,4,4,4,4,0],sa:[0,4,4,4,3,3,0,0,0,0,0,0,0,0,0,4,4,4,4,4,2],sb:[2,0,0,0,4,4,2,2,1,1,1,0,1,1,1,1,1,0,1,1,1],ca:[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2,2,1,2,2,1,2],cb:[3,2,2,2,1,1,4,4,3,3,4,2,2,2,2,3,2,2,2,2,2],ta:[4,3,3,3,2,2,4,4,0,0,4,3,3,3,3,4,3,3,3,3,4],tb:[4,0,0,0,3,3,4,4,1,1,4,4,4,4,4,4,4,4,4,4,4],tc:[2,1,1,1,0,0,2,2,2,2,2,1,2,2,2,2,1,2,2,1,2],td:[3,2,2,2,1,1,0,0,3,3,0,0,0,4,0,3,2,2,2,2,2],te:[4,3,3,3,2,2,0,0,4,4,0,1,0,4,0,4,3,3,3,3,4]},
        bar_flag: {hz:[1,1,1,1,0,0,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2],nr:[0,2,2,2,1,1,4,4,0,0,3,3,3,3,3,3,3,3,3,3,3],jr:[1,0,0,0,2,2,4,4,1,1,4,0,4,0,0,4,4,4,4,4,2],rr:[2,1,1,1,0,0,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1],ba:[3,2,2,2,1,1,0,0,0,0,0,2,0,2,2,2,2,2,2,2,0],bb:[0,3,3,3,2,2,0,0,0,0,0,0,0,0,0,4,4,4,4,4,0],sa:[0,4,4,4,3,3,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],sb:[1,0,0,0,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ca:[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],cb:[3,2,2,2,1,1,3,3,3,3,4,2,2,2,2,2,2,2,2,2,2],ta:[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],tb:[3,2,2,2,1,1,3,3,3,3,0,0,0,3,0,0,0,0,0,0,2],tc:[4,3,3,3,2,2,4,4,4,4,1,1,1,4,1,4,4,4,4,4,1],td:[2,0,0,0,3,3,2,2,1,1,0,0,0,0,0,0,0,0,0,0,1],te:[1,1,1,1,0,0,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1]}
    },
    right: {
        img: "reel3.png",
        hazure: {hz:[0,0,1,0,3,3,3,3,3,3,0,3,0,3,2,2,0,0,2,2,0],nr:[2,1,2,1,0,0,0,0,0,0,0,0,1,0,3,3,3,3,3,3,0],jr:[2,2,3,2,1,1,3,3,1,1,2,1,2,1,0,0,0,0,0,0,2],rr:[0,3,0,3,2,2,2,2,2,2,2,2,3,2,1,1,3,3,1,1,2],ba:[1,0,1,0,3,3,1,1,3,3,0,3,0,3,2,2,2,2,2,2,0],bb:[2,1,2,1,4,4,4,4,2,2,1,0,1,0,3,3,1,1,3,3,1],sa:[3,2,3,2,0,0,0,0,3,3,2,1,2,1,4,4,4,4,2,2,2],sb:[4,3,4,3,1,1,4,4,4,4,3,2,3,2,0,0,0,0,3,3,3],ca:[0,4,0,4,2,2,0,0,0,0,4,3,4,3,1,1,4,4,4,4,4],cb:[1,0,1,0,3,3,3,3,1,1,0,4,0,4,2,2,0,0,0,0,0],ta:Array(21).fill(n),tb:Array(21).fill(n),tc:Array(21).fill(n),td:Array(21).fill(n),te:Array(21).fill(n)},
        x_flag: {hz:[4,1,2,1,0,0,4,4,0,0,4,4,4,4,4,2,3,0,3,2,2],nr:[3,2,3,2,1,1,3,3,1,1,3,3,3,0,3,3,0,1,0,3,3],jr:[2,3,0,3,2,2,2,2,2,2,2,2,2,1,2,4,1,2,1,0,0],rr:[1,0,1,0,3,3,1,1,3,3,0,0,0,2,0,3,2,3,2,1,1],ba:[4,1,2,1,4,4,4,4,2,2,1,1,1,3,1,2,3,0,3,2,2],bb:[3,2,3,2,0,0,3,3,3,3,0,0,0,4,0,1,0,1,0,3,3],sa:[1,3,4,3,1,1,1,1,4,4,3,3,3,0,3,4,1,2,1,4,4],sb:[0,4,0,4,2,2,0,0,0,0,2,2,2,0,2,3,2,3,2,0,0],ca:[3,0,1,0,3,3,3,3,1,1,3,3,3,1,3,1,3,4,3,1,1],cb:[0,1,2,1,0,0,2,2,2,2,4,0,0,0,4,0,4,0,4,2,2],ta:[0,2,0,2,1,1,0,0,3,3,2,2,2,1,2,3,0,1,0,3,3],tb:[2,0,1,0,2,2,4,4,0,0,2,2,2,2,2,0,1,2,1,0,0],tc:[2,1,2,1,3,3,2,2,1,1,0,4,4,3,0,0,2,0,2,1,1],td:[0,2,3,2,0,0,0,0,0,0,0,4,4,4,0,2,0,1,0,2,2],te:[1,3,4,3,1,1,1,1,1,1,2,2,2,0,2,2,1,2,1,3,3]},
        seven_flag: {hz:[1,0,1,0,3,3,3,3,3,3,3,2,3,3,3,1,2,3,2,1,1],nr:[0,1,2,1,0,0,0,0,0,0,0,2,0,0,0,1,0,1,0,3,3],jr:[3,2,3,2,1,1,3,3,1,1,3,3,3,3,3,0,1,2,1,0,0],rr:[2,3,0,3,2,2,2,2,2,2,2,0,2,2,2,3,2,3,2,1,1],ba:[0,0,1,0,3,3,1,1,3,3,0,0,0,0,0,2,3,0,3,2,2],bb:[0,1,2,1,4,4,4,4,1,1,1,1,1,1,1,0,0,1,0,3,3],sa:[0,2,3,2,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,4,4],sb:[3,3,4,3,1,1,1,1,1,1,3,1,1,3,3,0,2,3,2,0,0],ca:[2,4,0,4,2,2,2,2,2,2,2,2,2,2,2,3,3,4,3,1,1],cb:[3,0,1,0,3,3,3,3,3,3,3,3,3,1,3,2,4,0,4,2,2],ta:[4,1,2,1,0,0,4,4,4,4,4,4,4,0,4,3,0,1,0,3,3],tb:[0,2,0,2,1,1,0,0,3,3,2,3,2,2,2,4,1,2,1,0,0],tc:[1,0,1,0,2,2,4,4,0,0,2,2,2,2,2,0,2,0,2,1,1],td:[0,1,2,1,3,3,0,0,1,1,0,3,4,4,0,1,0,1,0,2,2],te:[3,2,3,2,0,0,0,0,0,0,0,4,4,4,0,0,1,2,1,3,3]},
        bar_flag: {hz:[3,0,0,0,3,3,3,3,3,3,1,1,1,1,1,2,3,3,3,2,2],nr:[0,1,1,1,0,0,0,0,0,0,2,2,2,2,2,3,0,0,0,3,3],jr:[1,2,2,2,1,1,1,1,1,1,3,3,3,3,3,0,1,1,1,0,0],rr:[0,3,3,3,2,2,0,0,2,2,0,0,0,0,0,1,2,2,2,1,1],ba:[1,0,0,0,3,3,1,1,3,3,1,1,1,1,1,0,3,3,3,2,2],bb:[2,1,1,1,4,4,2,2,2,2,1,1,1,1,1,1,0,0,0,3,3],sa:[0,2,2,2,0,0,0,0,3,3,0,0,0,0,0,2,1,1,1,4,4],sb:[1,3,3,3,1,1,1,1,4,4,1,1,1,1,1,0,2,2,2,0,0],ca:[2,4,4,4,2,2,2,2,0,0,2,2,2,0,2,1,3,3,3,1,1],cb:[3,0,0,0,3,3,3,3,1,1,3,3,3,1,3,2,4,4,4,2,2],ta:[4,1,1,1,0,0,4,4,2,2,4,4,4,2,4,3,0,0,0,3,3],tb:[0,2,2,2,1,1,0,0,3,3,0,3,3,3,0,4,1,1,1,0,0],tc:[1,0,0,0,2,2,1,1,0,0,1,3,3,3,1,0,2,2,2,1,1],td:[0,1,1,1,3,3,0,0,1,1,0,4,4,4,0,1,0,0,0,2,2],te:[3,2,2,2,0,0,3,3,0,0,1,4,4,4,1,0,1,1,1,3,3]}
    }
};

const FLAGS = [
    {k:"hz",n:"ハズレ",c:"hazure"},{k:"nr",n:"通常リプ",c:"rep"},{k:"jr",n:"JACリプ",c:"rep"},{k:"rr",n:"RTリプ",c:"rep"},
    {k:"ba",n:"ベルA",c:"bell"},{k:"bb",n:"ベルB",c:"bell"},{k:"sa",n:"スイカA",c:"suika"},{k:"sb",n:"スイカB",c:"suika"},
    {k:"ca",n:"チェリーA",c:"cher"},{k:"cb",n:"チェリーB",c:"cher"},{k:"ta",n:"特殊役A",c:"tok"},{k:"tb",n:"特殊役B",c:"tok"},
    {k:"tc",n:"特殊役C",c:"tok"},{k:"td",n:"特殊役D",c:"tok"},{k:"te",n:"特殊役E",c:"tok"}
];
const mod = (n, m) => ((n % m) + m) % m;
const REEL_LEN = 21;

/**
 * 【静的逆引きマッピング：正規化エンジン】
 * 起動時に全リール・全状態について「停止位置 S」をキーとしたMAPを生成する。
 */
const REVERSE_MAP = { left: {}, middle: {}, right: {} };

function normalizeData() {
    ['left', 'middle', 'right'].forEach(reel => {
        ['hazure', 'x_flag', 'seven_flag', 'bar_flag'].forEach(state => {
            const stateData = RAW_DATA[reel][state];
            const map = {};
            // 全停止位置 (1..21) の受け皿を作成
            for (let s = 1; s <= REEL_LEN; s++) map[s] = {};

            FLAGS.forEach(flag => {
                const slips = stateData[flag.k];
                if (!slips) return;
                
                slips.forEach((L, P_idx) => {
                    if (L === null) return;
                    const P_num = 21 - P_idx; // 押し位置（記号番号）
                    // 物理法則：停止位置 S = 押し位置 P + 滑り L
                    let S_num = P_num + L;
                    if (S_num > 21) S_num -= 21;

                    if (!map[S_num][flag.k]) map[S_num][flag.k] = [];
                    map[S_num][flag.k].push({ p: P_num, l: L });
                });
            });
            REVERSE_MAP[reel][state] = map;
        });
    });
}

let currentBottomIdx = 10; // 初期：#11が下段（中段は#12）
let currentState = 'hazure', currentStop = 'left';

function update() {
    const list = document.getElementById('flag-list');
    list.innerHTML = '';
    
    // 中段の記号番号を取得 (下段の次の番号)
    let midNum = (21 - currentBottomIdx) + 1;
    if (midNum > 21) midNum -= 21;

    const stopData = REVERSE_MAP[currentStop][currentState][midNum];

    FLAGS.forEach(f => {
        const results = stopData[f.k];
        if (results && results.length > 0) {
            const row = document.createElement('div');
            row.className = `flag-item c-${f.c}`;
            
            // 押し位置の降順でソートして整形
            const dataStr = results
                .sort((a, b) => b.p - a.p)
                .map(r => `#${r.p}(${r.l})`)
                .join(' ');
            
            row.innerHTML = `<div class="flag-name">${f.n}</div><div class="flag-data">${dataStr}</div>`;
            list.appendChild(row);
        }
    });

    // リール同期描画
    const win = document.getElementById('reel-window');
    // 下段インデックス基準で座標計算
    const visualY = 280 - (currentBottomIdx + REEL_LEN) * 70;
    win.style.transform = `translate3d(0, ${visualY}px, 0)`;
}

function switchStop(side) {
    currentStop = side;
    document.querySelectorAll('.stop-tab').forEach(t => t.classList.toggle('active', t.id === 'stop-' + side));
    const img = RAW_DATA[side].img;
    document.querySelectorAll('.symbol-image').forEach(s => s.style.backgroundImage = `url('${img}')`);
    update();
}

function switchState(s) {
    currentState = s;
    document.querySelectorAll('.state-tab').forEach(t => t.classList.toggle('active', t.id === 'tab-' + s));
    update();
}

function init() {
    normalizeData(); // データを逆引き用に正規化

    const win = document.getElementById('reel-window');
    win.innerHTML = ''; 
    for (let l = 0; l < 3; l++) { 
        for (let i = 0; i < REEL_LEN; i++) {
            const nNum = 21 - i;
            const d = document.createElement('div');
            d.className = 'symbol';
            d.innerHTML = `<div class="index-num">${nNum}</div><div class="symbol-image" style="background-position:0% ${(21-nNum)*5}%"></div>`;
            win.appendChild(d);
        }
    }

    const area = document.getElementById('reel-touch-area'); 
    let isDragging = false, startY = 0, initialIdx = 0;

    const onStart = (y) => { isDragging = true; startY = y; initialIdx = currentBottomIdx; };
    const onMove = (y) => { 
        if (!isDragging) return; 
        const delta = Math.round((y - startY) / 70);
        currentBottomIdx = mod(initialIdx - delta, REEL_LEN); 
        update(); 
    };

    area.onmousedown = e => onStart(e.pageY);
    window.onmousemove = e => onMove(e.pageY);
    window.onmouseup = () => isDragging = false;
    area.addEventListener('touchstart', e => { onStart(e.touches[0].pageY); e.preventDefault(); }, {passive: false});
    area.addEventListener('touchmove', e => { onMove(e.touches[0].pageY); e.preventDefault(); }, {passive: false});
    area.addEventListener('touchend', () => isDragging = false);

    switchStop('left'); 
}

init();
</script>
</body>
</html>